(function(c,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue"),require("ethers")):typeof define=="function"&&define.amd?define(["exports","vue","ethers"],t):(c=typeof globalThis<"u"?globalThis:c||self,t(c.Tulipe={},c.vue,c.ethers))})(this,function(c,t,p){"use strict";class it{constructor(){const e=r.config.wallets.getAvailable();for(const n of e){const s=at[n.id];s&&(this[n.id]=new s)}}}class ct{constructor(){}init(){for(const e of r.config.networks.getAll())if(e.contracts)for(const[n,s]of Object.entries(e.contracts))this.add(n,s.address,s.abi)}add(e,n,s){const a=new p.ethers.Contract(n,s);r._ars.contracts.add(e),this[e]=new E(e,a),r._ars.contracts[e].start()}getAll(){const e={};for(const[n,s]of Object.entries(this))s instanceof E&&(e[n]=s);return e}}class lt{constructor(){this.contracts={},this.wallets={}}async _asyncInit(){r.provider.onSafe(()=>{r.provider.on("block",async function(e){const n=await r.provider.getBlockWithTransactions(e);for(const s of n.transactions)Object.keys(this.contracts).includes(s.to)?this.contracts[s.to].update():Object.keys(this.wallets).includes(s.to)&&this.wallets[s.to].update(),Object.keys(this.contracts).includes(s.from)?this.contracts[s.from].update():Object.keys(this.wallets).includes(s.from)&&this.wallets[s.from].update()})})}addContractWatcher(e){Object.keys(this.contracts).includes(e.address)||(this.contracts[e.address]=new tt(e))}removeContractWatcher(e){Object.keys(this.contracts).includes(e.address)&&delete this.contracts[e.address]}addWalletWatcher(e){Object.keys(this.wallets).includes(e)||(this.wallets[e]=new et(e))}removeContractWatcher(e){Object.keys(this.wallets).includes(e)&&delete this.wallets[e]}}class dt{constructor(){}init(e=null){this.config=new J(e),this._ars=new rt,this.status=this._ars.dapp.status,this.isSafe=this._ars.dapp.isSafe,this.OnSafe=this._ars.dapp.OnSafe,this.onSafe=this._ars.dapp.onSafe,this.chainWatchers=new lt,this.wallets=new it,this.provider=new C,this._ars.provider.start(),this.signer=new N,this._ars.signer.start(),this.contracts=new ct,this.contracts.init(),this.pro=this.provider,this.sig=this.signer,this.con=this.contracts}}const r=new dt;function k(o){return o&&typeof o=="object"&&!Array.isArray(o)}function _(o,...e){if(!e.length)return o;const n=e.shift();if(k(o)&&k(n))for(const s in n)k(n[s])?(o[s]||Object.assign(o,{[s]:{}}),_(o[s],n[s])):Object.assign(o,{[s]:n[s]});return _(o,...e)}function M(o){const e=o.split(" ");for(let n=0;n<e.length;n++)e[n]=e[n][0].toUpperCase()+e[n].substring(1);return e.join(" ")}function S(o){return t.isRef(o)?S(o.value):o}function u(o,e){t.isRef(o)?o.value=e:o=e}const be="",R={required:!1,type:String,default:"minimal",validator(o){return["unstylized","minimal","opinionated"].includes(o)}},ht={class:"ContractInteractor"},pt=t.createTextVNode(" Methods : "),ft=t.createElementVNode("br",null,null,-1),ut=t.createTextVNode(" Events : "),mt=t.createElementVNode("br",null,null,-1),L={__name:"ContractInteractor",props:{contract:{type:String,required:!0}},setup(o){const e=o,n=r.contracts[e.contract];let s=t.ref("not owned");return r.contracts[e.contract].onReadSafe(async function(){try{s.value=await n.owner()}catch{}}),(a,i)=>{const l=t.resolveComponent("OnContractReadSafe");return t.openBlock(),t.createBlock(l,{contract:e.contract},{default:t.withCtx(()=>[t.createElementVNode("div",ht,[t.createElementVNode("ul",null,[t.createElementVNode("li",null,"Address : "+t.toDisplayString(t.unref(n).address),1),t.createElementVNode("li",null,"Owner : "+t.toDisplayString(t.unref(s)),1),t.createElementVNode("li",null,[pt,ft,t.createVNode(t.unref(b),{contract:e.contract},null,8,["contract"])]),t.createElementVNode("li",null,[ut,mt,t.createVNode(t.unref(x),{contract:e.contract},null,8,["contract"])])])])]),_:1},8,["contract"])}}},yt={class:"MethodsInteractor"},b={__name:"MethodsInteractor",props:{contract:{type:String,required:!0}},setup(o){const e=o,n=r.contracts[e.contract];return(s,a)=>{const i=t.resolveComponent("OnContractReadSafe");return t.openBlock(),t.createBlock(i,{contract:e.contract},{default:t.withCtx(()=>[t.createElementVNode("div",yt,[t.createElementVNode("ul",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n).interface.functions,(l,d)=>(t.openBlock(),t.createElementBlock("li",null,[t.createVNode(t.unref(O),{contract:e.contract,method:d},null,8,["contract","method"])]))),256))])])]),_:1},8,["contract"])}}},_t={class:"MethodInteractor"},St={key:0},wt=t.createElementVNode("p",null,"Inputs :",-1),gt=["onUpdate:modelValue","placeholder"],Et={key:0},kt={key:1},Ct=t.createElementVNode("p",null,"Outputs :",-1),Nt=["onUpdate:modelValue","placeholder"],It=["placeholder"],Rt={key:2},O={__name:"MethodInteractor",props:{contract:{type:String,required:!0},method:{type:String,required:!0}},setup(o){const e=o,n=t.shallowRef(new U(e.contract,e.method));function s(a){return`${a.name&&a.name!=="null"?a.name:""} (${a.type})`}return(a,i)=>{const l=t.resolveComponent("OnContractReadSafe");return t.openBlock(),t.createBlock(l,{contract:e.contract},{default:t.withCtx(()=>[t.createElementVNode("div",_t,[t.createVNode(t.unref(P),{contract:e.contract,method:e.method,modelValue:t.unref(n),"onUpdate:modelValue":i[0]||(i[0]=d=>t.isRef(n)?n.value=d:null),configs:{content:e.method,notx:!0,noerror:!0}},null,8,["contract","method","modelValue","configs"]),t.createElementVNode("small",null,t.toDisplayString(t.unref(n).methodInfos.stateMutability),1),Object.keys(t.unref(n).methodInfos.inputs).length>0||t.unref(n).methodInfos.payable?(t.openBlock(),t.createElementBlock("div",St,[wt,t.createElementVNode("ul",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n).methodInfos.inputs,(d,h)=>(t.openBlock(),t.createElementBlock("li",null,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":f=>t.unref(n).args.value[h]=f,type:"text",placeholder:s(d)},null,8,gt),[[t.vModelText,t.unref(n).args.value[h]]]),t.createTextVNode(" "+t.toDisplayString(t.unref(n).args.value[h])+" "+t.toDisplayString(typeof t.unref(n).args.value[h]),1)]))),256)),t.unref(n).methodInfos.payable?(t.openBlock(),t.createElementBlock("li",Et,[t.createVNode(t.unref($),{modelValue:t.unref(n).txArgs.value.value,"onUpdate:modelValue":i[1]||(i[1]=d=>t.unref(n).txArgs.value.value=d)},null,8,["modelValue"]),t.createTextVNode(" "+t.toDisplayString(t.unref(n).txArgs.value.value)+" "+t.toDisplayString(typeof t.unref(n).txArgs.value.value),1)])):t.createCommentVNode("",!0)])])):t.createCommentVNode("",!0),Object.keys(t.unref(n).methodInfos.outputs).length>0?(t.openBlock(),t.createElementBlock("div",kt,[Ct,t.createElementVNode("ul",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n).methodInfos.outputs,(d,h)=>(t.openBlock(),t.createElementBlock("li",null,[t.unref(n).data.value?t.withDirectives((t.openBlock(),t.createElementBlock("input",{key:0,"onUpdate:modelValue":f=>t.unref(n).data.value[h]=f,type:"text",placeholder:s(d),disabled:""},null,8,Nt)),[[t.vModelText,t.unref(n).data.value[h]]]):(t.openBlock(),t.createElementBlock("input",{key:1,type:"text",placeholder:s(d),disabled:""},null,8,It))]))),256))])])):t.createCommentVNode("",!0),t.unref(n).status.is("ERROR")?(t.openBlock(),t.createElementBlock("p",Rt,t.toDisplayString(t.unref(n).error.value.reason),1)):t.createCommentVNode("",!0)])]),_:1},8,["contract"])}}},bt={class:"EventsInteractor"},x={__name:"EventsInteractor",props:{contract:{type:String,required:!0}},setup(o){const e=o,n=r.contracts[e.contract];return(s,a)=>{const i=t.resolveComponent("OnContractReadSafe");return t.openBlock(),t.createBlock(i,{contract:e.contract},{default:t.withCtx(()=>[t.createElementVNode("div",bt,[t.createElementVNode("ul",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(n).interface.events,(l,d)=>(t.openBlock(),t.createElementBlock("li",null,[t.createVNode(t.unref(B),{contract:e.contract,event:d},null,8,["contract","event"])]))),256))])])]),_:1},8,["contract"])}}},Ot={class:"EventInteractor"},xt=t.createTextVNode("Logs: "),B={__name:"EventInteractor",props:{contract:{type:String,required:!0},event:{type:String,required:!0}},setup(o){const e=o,n=r.contracts[e.contract];let s=t.ref({}),a=t.ref({}),i=t.ref(0),l=t.ref([]);return n.onReadSafe(()=>{s.value=n.interface.events[e.event],a.value=n.filters[s.value.name],n.on(a.value,d=>{i.value++;let h=`Block ${d.blockNumber} -> {`;for(const f of s.value.inputs)h+=`${f.name}:${d.args[f.name]}, `;h=h.substring(0,h.length-2)+"}",l.value.push(h)})}),(d,h)=>{const f=t.resolveComponent("OnContractReadSafe");return t.openBlock(),t.createBlock(f,{contract:e.contract},{default:t.withCtx(()=>[t.createElementVNode("div",Ot,[t.createElementVNode("p",null,t.toDisplayString(t.unref(s).name),1),t.createElementVNode("ul",null,[t.createElementVNode("li",null,"Count : "+t.toDisplayString(t.unref(i)),1),t.createElementVNode("li",null,[xt,t.createElementVNode("ul",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l),ot=>(t.openBlock(),t.createElementBlock("li",null,t.toDisplayString(ot),1))),256))])])])])]),_:1},8,["contract"])}}},Bt={class:"TransactButton"},Pt={key:1,disabled:""},Dt={key:2,disabled:""},Vt={key:3,disabled:""},At={key:4},P={__name:"Transact",props:{modelValue:{},contract:{type:String,required:!0},method:{type:String,required:!0},args:{type:Array,required:!1},txArgs:{type:Object,required:!1},configs:{type:Object,required:!1}},emits:["update:modelValue"],setup(o,{emit:e}){const n=o,s=r.contracts[n.contract];let a=t.computed({get(){return n.modelValue},set(l){e("update:modelValue",l)}});function i(){const l=n.args?n.args:[],d=n.txArgs?n.txArgs:{};a.value.send(l,d)}return n.config&&n.configs.notx&&s.onReadSafe(()=>{a=new U(n.contract,n.method)}),(l,d)=>{const h=t.resolveComponent("OnContractReadSafe");return t.openBlock(),t.createBlock(h,{contract:n.contract},{default:t.withCtx(()=>[t.createElementVNode("div",Bt,[t.unref(a).status.is("READY")?(t.openBlock(),t.createElementBlock("button",{key:0,onClick:i},t.toDisplayString(n.configs&&n.configs.content?n.configs.content:"Transact"),1)):t.unref(a).status.is("SENT")?(t.openBlock(),t.createElementBlock("button",Pt,"Transaction sent...")):t.unref(a).status.is("ERROR")?(t.openBlock(),t.createElementBlock("button",Dt,"Transaction error!")):t.unref(a).status.is("SUCCESS")?(t.openBlock(),t.createElementBlock("button",Vt,"Success !")):t.createCommentVNode("",!0),!(n.configs&&n.configs.noerror)&&t.unref(a).status.is("ERROR")?(t.openBlock(),t.createElementBlock("p",At,t.toDisplayString(t.unref(a).error.value.reason),1)):t.createCommentVNode("",!0)])]),_:1},8,["contract"])}}},Oe="",F=(o,e)=>{const n=o.__vccOpts||o;for(const[s,a]of e)n[s]=a;return n},q=F({__name:"ConnectWalletButton",props:{styleLevel:R},setup(o){const e=o;return(n,s)=>(t.openBlock(),t.createBlock(t.unref(r).provider.OnSafe,null,{default:t.withCtx(()=>[t.createElementVNode("div",{class:t.normalizeClass(["ConnectWalletButton",`ve-${e.styleLevel}`])},null,2)]),_:1}))}},[["__scopeId","data-v-a10b4efb"]]),Tt={class:"SelectWalletDropdown"},Wt={key:0},$t=[t.createElementVNode("p",null,"Connection requested...",-1)],Ut={key:1},jt=[t.createElementVNode("p",null,"Connection refused!",-1)],Mt={key:2},Lt=[t.createElementVNode("p",null,"Select a wallet",-1)],Ft=["src","alt"],qt=["onClick"],Gt=["src","alt"],G={__name:"SelectWalletDropdown",setup(o){let e=t.ref(null),n=t.ref([]),s=t.ref(!1),a=t.ref({});r.onSafe(async function(){n.value=r.config.wallets.getAvailable()}),r.provider.onSafe(async function(){a.value=await r.config.networks.getCurrent()}),r.signer.onSafe(async function(){e.value=await r.config.wallets.getCurrent(),n.value=r.config.wallets.getAvailable().filter(l=>l.id!==e.value.id)});function i(){s.value=!s.value}return(l,d)=>{const h=t.resolveComponent("OnDappSafe");return t.openBlock(),t.createBlock(h,null,{default:t.withCtx(()=>[t.createElementVNode("div",Tt,[t.createElementVNode("ul",null,[t.unref(r).signer.status.is("REQUESTED")?(t.openBlock(),t.createElementBlock("li",Wt,$t)):t.unref(r).signer.status.is("REFUSED")?(t.openBlock(),t.createElementBlock("li",Ut,jt)):t.unref(r).provider.status.is("WRONG_NETWORK")?(t.openBlock(),t.createElementBlock("li",Mt,[t.createElementVNode("p",null,"Wrong network! ("+t.toDisplayString(t.unref(a)?t.unref(a).displayName:"unknown")+")",1)])):t.unref(r).signer.status.is("DISCONNECTED")||!t.unref(e)?(t.openBlock(),t.createElementBlock("li",{key:3,onClick:i},Lt)):t.unref(r).signer.status.is("CONNECTED")?(t.openBlock(),t.createElementBlock("li",{key:4,onClick:i},[t.createElementVNode("img",{width:"40",src:t.unref(e).icon?t.unref(e).icon:t.unref(r).config.defaults.wallets.icon,alt:t.unref(e).displayName+" logo"},null,8,Ft),t.createElementVNode("p",null,t.toDisplayString(t.unref(e).displayName),1)])):t.createCommentVNode("",!0),t.unref(s)?(t.openBlock(!0),t.createElementBlock(t.Fragment,{key:5},t.renderList(t.unref(n),f=>(t.openBlock(),t.createElementBlock("li",{key:f.id,onClick:ot=>t.unref(r).signer.connectWallet(f.id)},[t.createElementVNode("img",{width:"40",src:f.icon?f.icon:t.unref(r).config.defaults.wallets.icon,alt:f.displayName+" logo"},null,8,Gt),t.createElementVNode("p",null,t.toDisplayString(f.displayName),1)],8,qt))),128)):t.createCommentVNode("",!0)])])]),_:1})}}},Ht={class:"SelectNetworkDropdown"},zt={key:0},Kt=["src","alt"],Jt={key:1},Yt=[t.createElementVNode("p",null,"Select a network",-1)],Zt=["onClick"],Qt=["src","alt"],H={__name:"SelectNetworkDropdown",setup(o){let e=t.ref({}),n=t.ref([]),s=t.ref(!1);r.onSafe(async function(){n.value=r.config.networks.getAvailable()}),r.provider.onSafe(async function(){e.value=await r.config.networks.getCurrent(),n.value=r.config.networks.getAvailable().filter(i=>i.id!==e.value.id)});function a(){s.value=!s.value}return(i,l)=>{const d=t.resolveComponent("OnDappSafe");return t.openBlock(),t.createBlock(d,null,{default:t.withCtx(()=>[t.createElementVNode("div",Ht,[t.createElementVNode("ul",{onClick:a},[t.unref(e)?(t.openBlock(),t.createElementBlock("li",zt,[t.createElementVNode("img",{width:"40",src:t.unref(e).icon?t.unref(e).icon:t.unref(r).config.defaults.networks.icon,alt:t.unref(e).displayName+" logo"},null,8,Kt),t.createElementVNode("p",null,t.toDisplayString(t.unref(e).displayName),1)])):(t.openBlock(),t.createElementBlock("li",Jt,Yt)),t.unref(s)?(t.openBlock(!0),t.createElementBlock(t.Fragment,{key:2},t.renderList(t.unref(n),h=>(t.openBlock(),t.createElementBlock("li",{key:h.id,onClick:f=>t.unref(r).provider.changeNetwork(h.id)},[t.createElementVNode("img",{width:"40",src:h.icon?h.icon:t.unref(r).config.defaults.networks.icon,alt:h.displayName+" logo"},null,8,Qt),t.createElementVNode("p",null,t.toDisplayString(h.displayName),1)],8,Zt))),128)):t.createCommentVNode("",!0)])])]),_:1})}}},D={__name:"OnDappSafe",setup(o){return(e,n)=>t.unref(r).isSafe.value?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.renderSlot(e.$slots,"default"),t.renderSlot(e.$slots,"safe")],64)):t.renderSlot(e.$slots,"unsafe",{key:1})}},V={__name:"OnProviderSafe",setup(o){return(e,n)=>t.unref(r).provider.isSafe.value?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.renderSlot(e.$slots,"default"),t.renderSlot(e.$slots,"safe")],64)):t.renderSlot(e.$slots,"unsafe",{key:1})}},A={__name:"OnSignerSafe",setup(o){return(e,n)=>t.unref(r).signer.isSafe.value?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.renderSlot(e.$slots,"default"),t.renderSlot(e.$slots,"safe")],64)):t.renderSlot(e.$slots,"unsafe",{key:1})}},T={__name:"OnContractReadSafe",props:{contract:{type:String,required:!0}},setup(o){const e=o;return(n,s)=>t.unref(r).contracts[e.contract].isReadSafe.value?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.renderSlot(n.$slots,"default"),t.renderSlot(n.$slots,"safe")],64)):t.renderSlot(n.$slots,"unsafe",{key:1})}},W={__name:"OnContractWriteSafe",props:{contract:{type:String,required:!0}},setup(o){const e=o;return(n,s)=>t.unref(r).contracts[e.contract].isWriteSafe.value?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.renderSlot(n.$slots,"default"),t.renderSlot(n.$slots,"safe")],64)):t.renderSlot(n.$slots,"unsafe",{key:1})}},Ae="",z=o=>(t.pushScopeId("data-v-a24ac687"),o=o(),t.popScopeId(),o),Xt=z(()=>t.createElementVNode("h3",null,"Safe Runners",-1)),vt=z(()=>t.createElementVNode("h3",null,"Status",-1)),K=F({__name:"DebugBar",setup(o){return(e,n)=>{const s=t.resolveComponent("OnDappSafe");return t.openBlock(),t.createBlock(s,null,{default:t.withCtx(()=>[t.createElementVNode("section",null,[t.createElementVNode("div",null,[Xt,t.createElementVNode("ul",null,[t.createElementVNode("li",null,"DApp safe : "+t.toDisplayString(t.unref(r).isSafe),1),t.createElementVNode("li",null,"Provider safe : "+t.toDisplayString(t.unref(r).provider.isSafe),1),t.createElementVNode("li",null,"Signer safe : "+t.toDisplayString(t.unref(r).signer.isSafe),1),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(r).contracts.getAll(),(a,i)=>(t.openBlock(),t.createElementBlock("li",null,[t.createTextVNode(" contract "+t.toDisplayString(i)+" : ",1),t.createElementVNode("ul",null,[t.createElementVNode("li",null,"read safe : "+t.toDisplayString(a.isReadSafe),1),t.createElementVNode("li",null,"write safe : "+t.toDisplayString(a.isWriteSafe),1)])]))),256))])]),t.createElementVNode("div",null,[vt,t.createElementVNode("ul",null,[t.createElementVNode("li",null,"dapp : "+t.toDisplayString(t.unref(r).status.get()),1),t.createElementVNode("li",null,"provider : "+t.toDisplayString(t.unref(r).provider.status.get()),1),t.createElementVNode("li",null,"signer : "+t.toDisplayString(t.unref(r).signer.status.get()),1),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(r).contracts.getAll(),(a,i)=>(t.openBlock(),t.createElementBlock("li",null," contract "+t.toDisplayString(i)+" : "+t.toDisplayString(a.status.get()),1))),256))])])])]),_:1})}}},[["__scopeId","data-v-a24ac687"]]),te={class:"InputUnits"},ee=["placeholder"],ne=["value"],$={__name:"InputUnits",props:{modelValue:{},placeholder:{type:String}},emits:["update:modelValue"],setup(o,{emit:e}){const n=o;let s=t.ref(null);const a=["wei","gwei","ether"];let i=t.ref("wei");function l(){if(s.value){const d=p.ethers.utils.parseUnits(s.value,i.value);e("update:modelValue",d)}}return(d,h)=>(t.openBlock(),t.createElementBlock("div",te,[t.withDirectives(t.createElementVNode("input",{onInput:l,"onUpdate:modelValue":h[0]||(h[0]=f=>t.isRef(s)?s.value=f:s=f),type:"text",placeholder:t.unref(n).placeholder},null,40,ee),[[t.vModelText,t.unref(s)]]),t.withDirectives(t.createElementVNode("select",{onChange:l,"onUpdate:modelValue":h[1]||(h[1]=f=>t.isRef(i)?i.value=f:i=f)},[(t.openBlock(),t.createElementBlock(t.Fragment,null,t.renderList(a,f=>t.createElementVNode("option",{value:f},t.toDisplayString(f),9,ne)),64))],544),[[t.vModelSelect,t.unref(i)]])]))}},se=Object.freeze(Object.defineProperty({__proto__:null,InputUnits:$,styleLevelProp:R,ContractInteractor:L,MethodsInteractor:b,MethodInteractor:O,EventsInteractor:x,EventInteractor:B,Transact:P,ConnectWalletButton:q,SelectWalletDropdown:G,SelectNetworkDropdown:H,OnDappSafe:D,OnProviderSafe:V,OnSignerSafe:A,OnContractReadSafe:T,OnContractWriteSafe:W,DebugBar:K},Symbol.toStringTag,{value:"Module"}));class w{constructor(e,n){if(this._name=e,this.states=[],!Array.isArray(n))throw`The 'states' parameter of a Status instance '${e}' must an array of strings. Got: ${n}`;for(const s of n)this.states.push(this._formatState(s));this._state=t.ref(this.states[0])}_formatState(e){return e.toString().toUpperCase()}_isStateValid(e){return!!this.states.includes(this._formatState(e))}_areStatesValid(e){for(const n of e)if(!this._isStateValid(n))return!1;return!0}get(){return S(this._state)}getRef(){return this._state}set(e){if(e=this._formatState(e),!this._isStateValid(e))throw`The state given to the set() method of Status instance '${this._name}' must a value in ${this.states}. Got: ${e}`;u(this._state,e),console.log(`Status '${this._name}' set to '${S(this._state)}'`)}is(e){if(!this._isStateValid(e))throw`The state given to the is() method of Status instance '${this._name}' must a value in ${this.states}. Got: ${e}`;return this.get()==this._formatState(e)}isIn(e){if(!this._areStatesValid(e))throw`The states given to the isIn() method of Status instance '${this._name}' must be an array with values in ${this.states}. Got: ${e}`;for(const n of e)if(this.is(n))return!0;return!1}watch(e,n){let s=`The states given to the watch() method of Status instance '${this._name}' must be a string or an array with values in ${this.states}. Got: ${e}`;if(Array.isArray(e)){if(!this._areStatesValid(e))throw s;return t.watch(this._state,()=>{this.isIn(e)&&n(this.get())})}else{if(!this._isStateValid(e))throw s;return t.watch(this._state,()=>{this.is(e)&&n(this.get())})}}watchAny(e){return this.watch(this.states,e)}}const m={style:{level:"minimal"},networks:[{name:"Ethereum Mainnet",displayName:"Ethereum",id:1,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/ethereum.svg",currency:{name:"Ether",symbol:"ETH",decimals:18},contracts:null,explorer:{name:"Etherscan",url:"https://etherscan.io/",standard:"EIP3091"},defaultRPC:"https://mainnet.infura.io/v3/"},{name:"Ropsten",displayName:"Ropsten (Ethereum Testnet)",id:3,type:"testnet",icon:null,currency:{name:"Ropsten Ether",symbol:"ETH",decimals:18},contracts:null,explorer:{name:"Etherscan",url:"https://ropsten.etherscan.io/",standard:"EIP3091"},defaultRPC:"https://ropsten.infura.io/v3/"},{name:"Rinkeby",displayName:"Rinkeby (Ethereum Testnet)",id:4,type:"testnet",icon:null,currency:{name:"Rinkeby Ether",symbol:"ETH",decimals:18},contracts:null,explorer:{name:"Etherscan",url:"https://rinkeby.etherscan.io/",standard:"EIP3091"},defaultRPC:"https://rinkeby.infura.io/v3/"},{name:"G\xF6rli",displayName:"G\xF6rli (Ethereum Testnet)",id:5,type:"testnet",icon:null,currency:{name:"G\xF6rli Ether",symbol:"ETH",decimals:18},contracts:null,explorer:{name:"Etherscan",url:"https://goerli.etherscan.io/",standard:"EIP3091"},defaultRPC:"https://goerli.infura.io/v3/"},{name:"Optimism",id:10,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/optimism.svg",currency:{name:"Ether",symbol:"ETH",decimals:18},contracts:null,explorer:{name:"Etherscan",url:"https://optimistic.etherscan.io/",standard:"EIP3091"},defaultRPC:"https://mainnet.optimism.io/"},{name:"Cronos Mainnet Beta",displayName:"Cronos",id:25,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/cronos.svg",currency:{name:"Cronos",symbol:"CRO",decimals:18},contracts:null,explorer:{name:"Cronos Explorer",url:"https://cronos.org/explorer",standard:"EIP3091"},defaultRPC:"https://evm.cronos.org"},{name:"Telos EVM Mainnet",displayName:"Telos",id:40,type:"mainnet",icon:null,currency:{name:"Telos",symbol:"TLOS",decimals:18},contracts:null,explorer:{name:"Teloscan",url:"https://teloscan.io/",standard:"EIP3091"},defaultRPC:"https://mainnet.telos.net/evm"},{name:"Binance Smart Chain Mainnet",displayName:"BSC",id:56,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/bsc.svg",currency:{name:"Binance Chain Native Token",symbol:"BNB",decimals:18},contracts:null,explorer:{name:"Bscscan",url:"https://bscscan.com/",standard:"EIP3091"},defaultRPC:"https://bsc-dataseed1.binance.org/"},{name:"Gnosis Chain",displayName:"Gnosis",id:100,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/gnosis.svg",currency:{name:"xDAI",symbol:"xDAI",decimals:18},contracts:null,explorer:{name:"Blockscout",url:"https://blockscout.com/xdai/mainnet/",standard:"EIP3091"},defaultRPC:"https://rpc.gnosischain.com"},{name:"Fuse Mainnet",displayName:"Fuse",id:122,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/fuse.svg",currency:{name:"Fuse",symbol:"FUSE",decimals:18},contracts:null,explorer:{name:"Fuse Explorer",url:"https://explorer.fuse.io/",standard:"EIP3091"},defaultRPC:"https://rpc.fuse.io"},{name:"Huobi ECO Chain Mainnet",displayName:"HECO",id:128,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/heco.svg",currency:{name:"Huobi ECO Chain Native Token",symbol:"HT",decimals:18},contracts:null,explorer:{name:"Hecoinfo",url:"https://hecoinfo.com",standard:"EIP3091"},defaultRPC:"https://http-mainnet.hecochain.com"},{name:"Polygon Mainnet",displayName:"Polygon",id:137,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/polygon.svg",currency:{name:"MATIC",symbol:"MATIC",decimals:18},contracts:null,explorer:{name:"Polygonscan",url:"https://polygonscan.com/",standard:"EIP3091"},defaultRPC:"https://polygon-rpc.com/"},{name:"Fantom Opera",displayName:"Fantom",id:250,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/fantom.svg",currency:{name:"Fantom",symbol:"FTM",decimals:18},contracts:null,explorer:{name:"Ftmscan",url:"https://ftmscan.com/",standard:"EIP3091"},defaultRPC:"https://rpc.ftm.tools"},{name:"Metis Andromeda Mainnet",displayName:"Metis",id:1088,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/metis.svg",currency:{name:"Metis",symbol:"METIS",decimals:18},contracts:null,explorer:{name:"Metis Explorer",url:"https://andromeda-explorer.metis.io",standard:"EIP3091"},defaultRPC:"https://andromeda.metis.io/?owner=1088"},{name:"Moonbeam",id:1284,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/moonbeam.svg",currency:{name:"Glimmer",symbol:"GLMR",decimals:18},contracts:null,explorer:{name:"Moonscan",url:"https://moonbeam.moonscan.io",standard:"EIP3091"},defaultRPC:"https://rpc.api.moonbeam.network"},{name:"Moonriver",id:1285,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/moonriver.svg",currency:{name:"Moonriver",symbol:"MOVR",decimals:18},contracts:null,explorer:{name:"Moonscan",url:"https://moonriver.moonscan.io/",standard:"EIP3091"},defaultRPC:"https://rpc.api.moonriver.moonbeam.network"},{name:"Klaytn Mainnet Cypress",displayName:"Klaytn",id:8217,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/klaytn.svg",currency:{name:"KLAY",symbol:"KLAY",decimals:18},contracts:null,explorer:{name:"Klaytnscope",url:"https://scope.klaytn.com",standard:"EIP3091"},defaultRPC:"https://public-node-api.klaytnapi.com/v1/cypress"},{name:"Hardhat",displayName:"Hardhat",id:31337,type:"testnet",icon:null,currency:{name:"GoChain Coin",symbol:"GO",decimals:18},contracts:null,explorer:null,defaultRPC:"http://127.0.0.1:8545/"},{name:"Arbitrum One",displayName:"Arbitrum",id:42161,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/arbitrum.svg",currency:{name:"Ether",symbol:"ETH",decimals:18},contracts:null,explorer:{name:"Arbiscan",url:"https://arbiscan.io/",standard:"EIP3091"},defaultRPC:"https://arbitrum-mainnet.infura.io/v3/"},{name:"Celo Mainnet",displayName:"Celo",id:42220,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/celo.svg",currency:{name:"CELO",symbol:"CELO",decimals:18},contracts:null,explorer:{name:"Celo Explorer",url:"https://explorer.celo.org/",standard:"EIP3091"},defaultRPC:"https://forno.celo.org"},{name:"Emerald Paratime Mainnet",displayName:"Emerald",id:42262,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/emerald.svg",currency:{name:"Emerald Rose",symbol:"ROSE",decimals:18},contracts:null,explorer:{name:"Emerald Explorer",url:"https://explorer.emerald.oasis.dev/",standard:"EIP3091"},defaultRPC:"https://emerald.oasis.dev"},{name:"Avalanche C-Chain",displayName:"Avalanche",id:43114,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/avalanche.svg",currency:{name:"Avalanche",symbol:"AVAX",decimals:18},contracts:null,explorer:{name:"Snowtrace",url:"https://snowtrace.io/",standard:"EIP3091"},defaultRPC:"https://api.avax.network/ext/bc/C/rpc"},{name:"Aurora Mainnet",displayName:"Aurora",id:1313161554,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/aurora.svg",currency:{name:"Ether",symbol:"ETH",decimals:18},contracts:null,explorer:{name:"Aurorascan",url:"https://aurorascan.dev",standard:"EIP3091"},defaultRPC:"https://mainnet.aurora.dev"},{name:"Harmony Mainnet Shard 0",displayName:"Harmony",id:16666e5,type:"mainnet",icon:"https://static.tuli.pe/icons/networks/harmony.svg",currency:{name:"ONE",symbol:"ONE",decimals:18},contracts:null,explorer:{name:"Harmony Block Explorer",url:"https://explorer.harmony.one",standard:"EIP3091"},defaultRPC:"https://api.harmony.one"}],wallets:[{id:"metamask",displayName:"Metamask",icon:null},{id:"binanceChain",displayName:"Binance Chain",icon:null},{id:"coinbase",displayName:"Coinbase",icon:null}],defaults:{networks:{icon:"https://static.tuli.pe/icons/networks/unknown.svg"},wallets:{icon:"TODO"}}};class ae{constructor(e=null){let n={};return e?n=_({...m.style},{...e}):n=m.style,window.addEventListener("load",()=>{const s=document.getElementsByClassName("ve-app");if(s)for(const a of s)a&&a.classList.add(`ve-${n.level}`)}),n}}class re{constructor(e=null){if(this._list=[],e){for(const n of e)if(n.id){const s=m.networks.find(i=>i.id===n.id),a=_({...s},{...n});a.available!==!1&&(a.available=!0),a.displayName||(a.displayName=a.name),this._list.push(a)}}for(const n of m.networks)this._list.find(a=>a.id===n.id)||(n.available=!1,this._list.push(n))}add(e){this._list.push(e)}async getCurrent(){if(r.provider.proxy.ethersInstance){const e=await r.provider.getNetwork().then(n=>n.chainId);return this.getById(e)}return null}getById(e){try{e=parseInt(e)}catch{throw"'id' given to getById() method must be an integer or any data type that can be parsed to interger."}return this._list.find(n=>n.id===parseInt(e))}getDefault(){return this._list.find(e=>e.default===!0)}getAvailable(){return this._list.filter(e=>e.available)}getAll(){return this._list}}class oe{constructor(e=null){if(this._list=[],e){for(const n of e)if(n.id){const s=m.wallets.find(i=>i.id===n.id),a=_({...s},{...n});a.available!==!1&&(a.available=!0),a.displayName||(a.displayName=a.id),this._list.push(a)}}for(const n of m.wallets)this._list.find(a=>a.id===n.id)||(n.available=!1,this._list.push(n))}getCurrent(){return r.signer.proxy.ethersInstance?this.getById(r.signer.walletId):null}getById(e){return this._list.find(n=>n.id===e)}getDefault(){return this._list.find(e=>e.default===!0)}getAvailable(){return this._list.filter(e=>e.available)}getAll(){return this._list}}class ie{constructor(e=null){let n={};return e?n=_({...m.defaults},{...e}):n=m.defaults,n}}class J{constructor(e=null){this.style=new ae(e?e.style:null),this.networks=new re(e?e.networks:null),this.wallets=new oe(e?e.wallets:null),this.defaults=new ie(e?e.defaults:null)}}class g{constructor(e=null,n=null){console.log("TulipeProxy super");const s=new Proxy(this,{get:function(a,i,l){if(a.proxy.ethersInstance&&a.proxy.ethersInstance[i]!==void 0)return typeof a.proxy.ethersInstance[i]=="function"?a.proxy.ethersInstance[i].bind(a.proxy.ethersInstance):a.proxy.ethersInstance[i];if(a.proxy.ethersInstance&&a.proxy.extensionInstance&&a.proxy.extensionInstance[i]!==void 0)return typeof a.proxy.extensionInstance[i]=="function"?a.proxy.extensionInstance[i].bind(l):a.proxy.extensionInstance[i];if(a&&a[i]!==void 0)return typeof a[i]=="function"?a[i].bind(l):a[i]},set:function(a,i,l,d){return a.proxy.ethersInstance&&a.proxy.ethersInstance[i]!==void 0?(a.proxy.ethersInstance[i]=l,!0):a.proxy.extensionInstance&&a.proxy.extensionInstance[i]!==void 0?(a.proxy.extensionInstance[i]=l,!0):(a[i]=l,!0)}});return this.proxy={_changeWatchers:[],onChange:function(a){this._changeWatchers.push(a)},_initIsRunning:!1,_ethersInstance:null,get ethersInstance(){return this._ethersInstance},set ethersInstance(a){const i={...this._ethersInstance};this._ethersInstance=a&&t.markRaw(a);for(const l of this._changeWatchers)l(this._ethersInstance,i);this._initIsRunning||(this._initIsRunning=!0,s._asyncInit().finally(()=>{this._initIsRunning=!1}))},extensionInstance:n},this.proxy.ethersInstance=e,s}}class ce{}class le{constructor(){this._ars={}}_purgeARS(){if(this._ars.unwatchers)for(const e of this._ars.unwatchers)e();if(this._ars.unwatchers=[],this._ars.oldEthersInstance&&this._ars.events)for(const[e,n]of Object.entries(this._ars.events))this._ars.oldEthersInstance.off(e,n)}_initEthersInstanceARS(){}_initPlaceholderInstanceARS(){}_initARS(){this._purgeARS(),this.proxy.ethersInstance&&this._initEthersInstanceARS(),this._initPlaceholderInstanceARS()}onSafe(e){const n=t.getCurrentInstance();if(this.isSafe.value)e(n);else{const s=t.watch(this.isSafe,()=>{this.isSafe.value&&(e(n),s())})}}}class C extends g{constructor(e=null,n=null){super(e,n||new ce),this.status=r._ars.provider.status,this.isSafe=r._ars.provider.isSafe,this.OnSafe=r._ars.provider.OnSafe,this.onSafe=r._ars.provider.onSafe}async _autoInstantiateFromWallet(){let e=null;for(const n of Object.values(r.wallets))if(n.lazyConnectAvailable&&await n.isConnected()){e=n;break}if(e)this.proxy.ethersInstance=e.getProvider();else for(const n of Object.values(r.wallets)){const s=n.getProvider();s&&(this.proxy.ethersInstance=s)}}_autoInstantiateFromDefaultConfig(){const e=r.config.networks.getDefault();e&&e.defaultRPC&&(this.proxy.ethersInstance=new p.ethers.providers.JsonRpcProvider(e.defaultRPC))}async _autoInstantiate(){await this._autoInstantiateFromWallet(),this.proxy.ethersInstance||this._autoInstantiateFromDefaultConfig()}async _checkNetwork(){if(!this.proxy.ethersInstance)throw"<TulipeProviderProxy instance>._checkNetwork() method must not be called if the ethersInstance is null (if not connected to any network).";const e=await this.getNetwork();let n=await r.config.networks.getById(e.chainId);if(n)this.status.set("CONNECTED");else if(this.status.set("WRONG_NETWORK"),n=r.config.networks.getAll().find(s=>s.id===e.id),!n){const s={name:e.name,displayName:M(e.name),id:e.chainId};console.log(s),r.config.networks.add(s)}}async _setNetworkSettings(){const e=await this.getNetwork();let n=await r.config.networks.getById(e.chainId);n&&n&&n.pollingInterval&&(this.pollingInterval=n.pollingInterval)}async _asyncInit(){this.proxy.ethersInstance||await this._autoInstantiate(),this.proxy.ethersInstance?(await this._checkNetwork(),await this._setNetworkSettings()):this.status.set("DISCONNECTED")}async changeNetwork(e){const n=await r.config.wallets.getCurrent();n&&r.wallets[n.id].changeNetwork(e)}}class de{}class N extends g{constructor(e=null,n=null){super(e,n||new de),this.walletId=null,this.address=t.ref(null),this.status=r._ars.signer.status,this.isSafe=r._ars.signer.isSafe,this.OnSafe=r._ars.signer.OnSafe,this.onSafe=r._ars.signer.onSafe}async _autoInstantiate(){for(const e of Object.keys(r.wallets))if(r.wallets[e].lazyConnectAvailable&&(await this.connectWallet(e,!0),this.proxy.ethersInstance))break}async _asyncInit(){r.provider.onSafe(async function(){this.proxy.ethersInstance||await this._autoInstantiate(),this.proxy.ethersInstance?this.address.value=await this.getAddress():this.status.set("DISCONNECTED")}.bind(this))}async connectWallet(e,n=!1){const s=r.wallets[e];if(s.lazyConnectAvailable){if(await s.connect(!0),await s.isConnected())r.signer.proxy.ethersInstance=await s.getSigner(),this.walletId=s.id,r.signer.status.set("CONNECTED");else if(n){r.signer.status.set("DISCONNECTED");return}}try{this.status.set("REQUESTED"),await s.connect(!1),r.signer.proxy.ethersInstance=await s.getSigner(),this.walletId=s.id,r.signer.status.set("CONNECTED")}catch(a){if(a instanceof I)this.status.set("REFUSED");else throw this.status.set("ERROR"),a}}disconnectWallet(){r.signer.proxy.ethersInstance=null,this.address.value=null,r.signer.status.set("DISCONNECTED")}}class he{_watch(e,n,s=null){return Object.keys(r.chainWatchers.contracts).includes(this.address)||r.chainWatchers.addContractWatcher(this),r.chainWatchers.contracts[this.address].add(e,n,s)}watch(e,n,s,a=null){const i=this._watch(e,n,s);return a?t.onUnmounted(()=>{r.chainWatchers.contracts[this.address].remove(e,n,i)},a):t.onUnmounted(()=>{r.chainWatchers.contracts[this.address].remove(e,n,i)}),r.chainWatchers.contracts[this.address].remove.bind(r.chainWatchers.contracts[this.address],e,n,i)}watchRef(e,n,s=null){const a=this._watch(e,n,null);return s?t.onUnmounted(()=>{r.chainWatchers.contracts[this.address].remove(e,n,a)},s):t.onUnmounted(()=>{r.chainWatchers.contracts[this.address].remove(e,n,a)}),r.chainWatchers.contracts[this.address].getRef(e,n)}}class E extends g{constructor(e,n=null,s=null){console.log("init proxy"),console.log(e),console.log(n),super(n,s||new he),console.log("proxxx"),console.log(this.proxy),this.name=e,this.status=r._ars.contracts[this.name].status,this.isReadSafe=r._ars.contracts[this.name].isReadSafe,this.isWriteSafe=r._ars.contracts[this.name].isWriteSafe,this.OnReadSafe=r._ars.contracts[this.name].OnReadSafe,this.OnWriteSafe=r._ars.contracts[this.name].OnWriteSafe,this.onReadSafe=r._ars.contracts[this.name].onReadSafe,this.onWriteSafe=r._ars.contracts[this.name].onWriteSafe,console.log("proxxx 2"),console.log(this.proxy)}onSafe(e){throw"TulipeContract instances don't have 'onSafe()' method, use 'onReadSafe()' and 'onWriteSafe()' instead."}async _asyncInit(){console.log("proxxx 3"),console.log(this.proxy),r.provider.onSafe(async function(){this.proxy.ethersInstance?(this.name="TODO",this.status.set("INITIALIZED")):(console.log(this.proxy),console.log("marked as UNVAILABLE !"),this.status.set("UNAVAILABLE"))}.bind(this))}}class pe{}class fe extends le{constructor(){super(),this.contractName=null,this.methodName=null,this.methodInfos={},this.args=t.ref(args),this.txArgs=t.ref(txArgs),this.data=t.ref([]),this.error=t.ref(null),this.call=null,this.status=new w(`tx:${contractName}:${methodName}`,["NOT_READY","READY","SENT","ERROR","SUCCESS"])}initARS(){this.status.watch(["ERROR","SUCCESS"],()=>{setTimeout(()=>{this.status.set("READY")},3e3)})}_asyncInit(){this.proxy._initIsRunning=!0,r.contracts[this.contractName].isReadSafe.value&&this._initEthersInstance(),r.contracts[this.contractName].onReadSafe(()=>{this._initEthersInstance()}),this.initARS(),this.proxy._initIsRunning=!1}_initEthersInstance(){this.methodInfos=r.contracts[this.contractName].interface.functions[this.methodName],this.methodInfos.inputs.forEach(e=>this.args.value.push(null)),this.methodInfos.outputs.forEach(e=>this.data.value.push(null)),this.proxy.ethersInstance=r.contracts[this.contractName][this.methodName],this.status.set("READY")}send(e=null,n=null){e=e&&e.length>0?e:S(this.args),e?Array.isArray(e)?this.call=this.proxy.ethersInstance(...e,n):this.call=this.proxy.ethersInstance(e,n):this.call=this.proxy.ethersInstance(n),this.status.set("SENT"),this.methodInfos.constant?this.call.then(s=>{Array.isArray(s)||(s=[s]),u(this.data,s),u(this.error,null),this.status.set("SUCCESS")}).catch(s=>{u(this.error,s),this.status.set("ERROR")}):this.call.then(s=>s.wait()).then(s=>{Array.isArray(s)||(s=[s]),u(this.data,s),u(this.error,null),this.status.set("SUCCESS")}).catch(s=>{u(this.error,s),this.status.set("ERROR"),console.log(s)})}}class U extends g{constructor(e,n,s=[],a={value:0},i=null,l=null,d=null){super(i,l||new pe,d||new fe(e,n,s=[],a={value:0})),this._asyncInit()}}const ue={JsonRpcProvider:p.ethers.providers.JsonRpcProvider,StaticJsonRpcProvider:p.ethers.providers.StaticJsonRpcProvider,EtherscanProvider:p.ethers.providers.EtherscanProvider,InfuraProvider:p.ethers.providers.InfuraProvider,AlchemyProvider:p.ethers.providers.AlchemyProvider,CloudflareProvider:p.ethers.providers.CloudflareProvider,PocketProvider:p.ethers.providers.PocketProvider,AnkrProvider:p.ethers.providers.AnkrProvider,FallbackProvider:p.ethers.providers.FallbackProvider,IpcProvider:p.ethers.providers.IpcProvider,JsonRpcBatchProvider:p.ethers.providers.JsonRpcBatchProvider,UrlJsonRpcProvider:p.ethers.providers.UrlJsonRpcProvider,Web3Provider:p.ethers.providers.Web3Provider,WebSocketProvider:p.ethers.providers.WebSocketProvider},Y={};for(const[o,e]of Object.entries(ue))Y[o]=class extends e{constructor(...n){let s=C;return n.length>0&&n[n.length-1]&&n[n.length-1].prototype instanceof C&&(s=n.pop()),super(...n),new s(this)}};const me={Wallet:p.ethers.Wallet,VoidSigner:p.ethers.VoidSigner},Z={};for(const[o,e]of Object.entries(me))Z[o]=class extends e{constructor(...n){let s=N;return n.length>0&&n[n.length-1]&&n[n.length-1].prototype instanceof N&&(s=n.pop()),super(...n),new s(this)}};const ye={Contract:p.ethers.Contract},Q={};for(const[o,e]of Object.entries(ye))Q[o]=class extends e{constructor(...n){let s=E;n.length>0&&n[n.length-1]&&n[n.length-1].prototype instanceof E&&(s=n.pop()),super(...n);const a=new s(this);return console.log(a),a}};const _e={...Y,...Z,...Q},X={...p.ethers};for(const[o,e]of Object.entries(_e))X[o]=e;class v{constructor(){this.lastUpdateBlock=0,this.sources={}}_generateDependentUUID(){return"xxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,s=e=="x"?n:n&3|8;return s.toString(16)})}async requiresUpdate(){if(!r.provider.isSafe.value)return!1;const e=await r.provider.getBlockNumber();return this.lastUpdateBlock<e}async updateLastUpdateBlock(){const e=await r.provider.getBlockNumber();this.lastUpdateBlock=e}async _update(){throw"_update() method not implemented in that ChainWatcher child class."}update(){this._update()}}class tt extends v{constructor(e){super(),this.contract=e}_buildSourceName(e,n){return`${e}:${n?n.toString():""}`}async _updateState(e){e.args?e.state.value=await this.contract[e.name](...e.args):e.state.value=await this.contract[e.name]()}async _update(){if(await this.requiresUpdate()){for(const e of Object.values(this.sources))this._updateState(e);await this.updateLastUpdateBlock()}}add(e,n,s=null){const a=this._buildSourceName(e,n);let i=!1;Object.keys(this.sources).includes(a)||(this.sources[a]={name:e,args:n,state:t.ref(null),dependents:{}},i=!0);let l=null;s&&(l=t.watch(this.sources[a].state,s));const d=this._generateDependentUUID();return this.sources[a].dependents[d]=l,i&&this._updateState(this.sources[a]),d}remove(e,n,s){const a=this._buildSourceName(e,n);if(Object.keys(this.sources).includes(a)&&Object.keys(this.sources[a].dependents).includes(s)){const i=this.sources[a].dependents[s];i&&i(),delete this.sources[a].dependents[s]}Object.keys(this.sources[a].dependents).length===0&&delete this.sources[a]}getRef(e,n){const s=this._buildSourceName(e,n);return this.sources[s].state}}class et extends v{constructor(e){super(),this.address=e,this.availableSources=["balance"]}async _updateState(e){e.name==="balance"&&(e.state.value=await r.provider.getBalance(this.address))}async _update(){if(await this.requiresUpdate()){for(const e of Object.values(this.sources))await this._updateState(e);await this.updateLastUpdateBlock()}}add(e,n,s=null){if(!this.availableSources.includes(e))throw`Sources added to a ChainWalletWatcher must be in ${this.availableSources}. Got ${e}`;const a=this._buildSourceName(e,n);newSource=!1,Object.keys(this.sources).includes(a)||(this.sources[a]={name:e,args:n,state:ref(null),dependents:{}},newSource=!0);let i=null;s&&(i=watch(this.sources[a].state,s));const l=this._generateDependentUUID();return this.sources[a].dependents[l]=i,newSource&&this._updateState(this.sources[a]),l}remove(e,n,s){const a=this._buildSourceName(e,n);if(Object.keys(this.sources).includes(a)&&Object.keys(this.sources[a].dependents).includes(s)){const i=this.sources[a].dependents[s];i&&i(),delete this.sources[a].dependents[s]}Object.keys(this.sources[a].dependents).length===0&&delete this.sources[a]}getRef(e,n){const s=this._buildSourceName(e,n);return this.sources[s].state}}class I extends Error{constructor(e,...n){super(e,...n),this.message=`'${e}' wallet has rejected the connection request.`}}class y extends Error{constructor(e,...n){super(walletId,...n),this.message=e}}class nt{constructor(e){this.id=e,this.lazyConnectAvailable=!0}isConnected(){throw new y(`isConnected() method is not implemented in ${this.id} wallet class.`)}getProvider(){throw new y(`getProvider() method is not implemented in ${this.id} wallet class.`)}getSigner(e=!1){throw new y(`getSigner() method is not implemented in ${this.id} wallet class.`)}async connect(e=!1){throw new y(`connect() method is not implemented in ${this.id} wallet class.`)}addNetwork(e){throw new y(`addNetwork() method is not implemented in ${this.id} wallet class.`)}switchNetwork(e,n=!1){throw new y(`switchNetwork() method is not implemented in ${this.id} wallet class.`)}}class st extends nt{constructor(e,n=null){super(e),this.exposedObject=n}async isConnected(){if(this.exposedObject&&this.getSigner())try{const n=await this.exposedObject.request({method:"eth_accounts"});if(n&&n.length>0)return!0}catch{}return!1}getProvider(){return this.exposedObject?new p.ethers.providers.Web3Provider(this.exposedObject,"any"):null}async getSigner(){if(this.exposedObject){const e=this.getProvider();if(e)return await e.getSigner()}return null}async connect(e=!1){if(this.exposedObject){if(await this.isConnected()||e)return;try{await this.exposedObject.request({method:"eth_requestAccounts"})}catch(n){throw n.code===4001?new I(this.id):n}}throw"exposedObject not available"}async addNetwork(e){const n=r.config.networks.getById(e);await this.exposedObject.request({method:"wallet_addEthereumChain",params:[{chainId:e,rpcUrls:[n.defaultRPC],chainName:n.name,nativeCurrency:{name:n.currency.symbol,symbol:n.currency.symbol,decimals:n.currency.decimals},blockExplorerUrls:n.explorer&&n.explorer.url!==""?[n.explorer.url]:null}]})}async changeNetwork(e,n=!1){if(r.config.networks.getById(e)){e=p.ethers.utils.hexlify(parseInt(e)).toString(),e=p.ethers.utils.hexValue(e);try{await this.exposedObject.request({method:"wallet_switchEthereumChain",params:[{chainId:e}]})}catch(a){if(a.code===4902)this.addNetwork(e);else throw a}}}}class Se extends st{constructor(){super("metamask",window.ethereum)}}class we extends nt{constructor(e,n={}){super(),this.id="coinbase";const s=n.appName||"",a=n.appLogoUrl,i=n.darkMode||!1;this.coinbaseWalletSdk=new e({appName:s,appLogoUrl:a,darkMode:i}),this.provider=this.getProvider()}getProvider(){try{return this.coinbaseWalletSdk.makeWeb3Provider()}catch(e){return console.log(e),null}}async connect(){try{await this.provider.send("eth_requestAccounts")}catch{throw I(this.id)}}}class ge extends st{constructor(){super("binanceChain",window.BinanceChain),this.lazyConnectAvailable=!1}async isConnected(){throw new y("isConnected() method is not available for BinanceChainWallet class since lazy connection is not available.")}async connect(e=!1){if(e)throw new y("connect() with 'lazy=true' is not available for BinanceChainWallet class because isConnected() is not available on this class.")}}const at={metamask:Se,coinbase:we,binanceChain:ge};class Ee{constructor(){this.status=new w("dapp",["UNSAFE","ERROR","INITIALIZED"]),this.isSafe=t.computed(()=>this.status.is("INITIALIZED")),this.OnSafe=D}onSafe(e){const n=t.getCurrentInstance();if(this.isSafe.value)e(n);else{const s=t.watch(this.isSafe,()=>{this.isSafe.value&&(e(n),s())})}}}class j{constructor(){this._ars={oldEthersInstance:null,events:{},watchers:[]}}_purgeARS(){if(this._ars.unwatchers)for(const e of this._ars.unwatchers)e();if(this._ars.unwatchers=[],this._ars.oldEthersInstance&&this._ars.events)for(const[e,n]of Object.entries(this._ars.events))this._ars.oldEthersInstance.off(e,n)}_initEthersInstanceARS(){}_initPlaceholderInstanceARS(){}_initARS(e){this._purgeARS(),e.proxy.ethersInstance&&(console.log("instance ARS"),console.log(e),this._initEthersInstanceARS()),this._initPlaceholderInstanceARS()}start(e){this._initARS(e),e.proxy.onChange(this._initARS.bind(this,e))}onSafe(e){const n=t.getCurrentInstance();if(this.isSafe.value)e(n);else{const s=t.watch(this.isSafe,()=>{this.isSafe.value&&(e(n),s())})}}}class ke extends j{constructor(){super(),this.status=new w("provider",["DISCONNECTED","ERROR","WRONG_NETWORK","CONNECTED"]),this.isSafe=t.computed(()=>r.isSafe.value&&!this.status.isIn(["DISCONNECTED","ERROR"])),this.OnSafe=V}_initEthersInstanceARS(){r.provider.on("network",(e,n)=>{n&&n!==e&&window.location.reload()}),r.provider.on("error",()=>{this.status.set("ERROR")})}_initPlaceholderInstanceARS(){}start(){super.start(r.provider)}onSafe(e){const n=t.getCurrentInstance();if(this.isSafe.value)e(n);else{const s=t.watch(this.isSafe,()=>{this.isSafe.value&&(e(n),s())})}}}class Ce extends j{constructor(){super(),this.status=new w("signer",["NO_PROVIDER","DISCONNECTED","REQUESTED","REFUSED","ERROR","WRONG_NETWORK","CONNECTED"]),this.isSafe=t.computed(()=>r.provider.isSafe.value&&this.status.is("CONNECTED")),this.OnSafe=A}_initEthersInstanceARS(){}_initPlaceholderInstanceARS(){r.provider.status.watchAny(e=>{e==="WRONG_NETWORK"?this.status.set("WRONG_NETWORK"):["DISCONNECTED","ERROR"].includes(e)&&this.status.set("NO_PROVIDER")}),this.status.watch(["REFUSED","ERROR"],()=>{setTimeout(()=>{this.status.set("DISCONNECTED")},5e3)})}start(){super.start(r.signer)}onSafe(e){const n=t.getCurrentInstance();if(this.isSafe.value)e(n);else{const s=t.watch(this.isSafe,()=>{this.isSafe.value&&(e(n),s())})}}}class Ne extends j{constructor(e){super(),this.name=e,this.status=new w(`contract:${e}`,["NO_PROVIDER","UNAVAILABLE","ERROR","INITIALIZED"]),this.isReadSafe=t.computed(()=>r.provider.isSafe.value&&this.status.is("INITIALIZED")),this.isWriteSafe=t.computed(()=>r.signer.isSafe.value&&this.status.is("INITIALIZED")),this.OnReadSafe=t.createVNode(T,{contract:e}),this.OnWriteSafe=t.createVNode(W,{contract:e})}onReadSafe(e){const n=t.getCurrentInstance();if(this.isReadSafe.value)e(n);else{const s=t.watch(this.isReadSafe,()=>{this.isReadSafe.value&&(e(n),s())})}}onWriteSafe(e){const n=t.getCurrentInstance();if(this.isWriteSafe.value)e(n);else{const s=t.watch(this.isWriteSafe,()=>{this.isWriteSafe.value&&(e(n),s())})}}_updateContract(e,n){if(r.signer.isSafe.value)r.contracts[this.name].proxy.ethersInstance=new p.ethers.Contract(e,n,r.signer.proxy.ethersInstance);else if(r.provider.isSafe.value)r.contracts[this.name].proxy.ethersInstance=new p.ethers.Contract(e,n,r.provider.proxy.ethersInstance);else throw`_updateContract() is called for contract ${this.name} but neither provider nor signer are available.`}_initEthersInstanceARS(){this._ars.watchers.push(t.watch(r.signer.isSafe,(e,n)=>{if(e!==n){const s=r.contracts[this.name].proxy.ethersInstance.interface,a=r.contracts[this.name].proxy.ethersInstance.address;this._updateContract(a,s)}}))}_initPlaceholderInstanceARS(){r.provider.status.watchAny(e=>{e==="WRONG_NETWORK"?(console.log("UNAVVS"),this.status.set("UNAVAILABLE")):["DISCONNECTED","ERROR"].includes(e)&&this.status.set("NO_PROVIDER")})}start(){super.start(r.contracts[this.name])}}class Ie{constructor(e){for(const n of r.config.networks.getAll())if(n.contracts)for(const[s,a]of Object.entries(n.contracts))this.add(s)}add(e){this[e]=new Ne(e)}}class rt{constructor(){this.dapp=new Ee,this.provider=new ke,this.signer=new Ce,this.contracts=new Ie}}async function Re(o,e){const n=e;try{r.init(n)}catch(a){throw r&&r.status&&r.status.set("ERROR"),a}o.config.globalProperties.dapp=r,o.config.globalProperties.rGet=S,o.config.globalProperties.rSet=u,window.dapp=r;const s=await Promise.resolve().then(()=>se);o.component("OnDappSafe",s.OnDappSafe),o.component("OnProviderSafe",s.OnProviderSafe),o.component("OnSignerSafe",s.OnSignerSafe),o.component("OnContractReadSafe",s.OnContractReadSafe),o.component("OnContractWriteSafe",s.OnContractWriteSafe),r.status.set("INITIALIZED")}c.ARS=rt,c.ConnectWalletButton=q,c.ContractInteractor=L,c.ContractWatcher=tt,c.DebugBar=K,c.EventInteractor=B,c.EventsInteractor=x,c.InputUnits=$,c.MethodInteractor=O,c.MethodsInteractor=b,c.OnContractReadSafe=T,c.OnContractWriteSafe=W,c.OnDappSafe=D,c.OnProviderSafe=V,c.OnSignerSafe=A,c.SelectNetworkDropdown=H,c.SelectWalletDropdown=G,c.Status=w,c.Transact=P,c.TulipeConfig=J,c.TulipeContractProxy=E,c.TulipeProviderProxy=C,c.TulipeProxy=g,c.TulipeSignerProxy=N,c.TulipeTransactionProxy=U,c.WalletConnectionRejected=I,c.WalletWatcher=et,c.capitalizeWords=M,c.dapp=r,c.deepMerge=_,c.initTulipe=Re,c.isObject=k,c.rGet=S,c.rSet=u,c.styleLevelProp=R,c.tulipeEthers=X,c.wallets=at,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
